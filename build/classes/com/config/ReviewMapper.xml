<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ReviewMapper">
	<select id="review" resultType="ReviewProfileDTO" parameterType="string">
		select * from profile join review USING(userid) where P_ID = #{p_ID}
	</select>
	
	<select id="selectUserReview" resultType="com.dto.ReviewDTO">
		select * from review
		where userid=#{userid}
	</select>
	
	<select id="countTotalUserReview" resultType="int">
		select count(*) from review
		where userid=#{userid}
	</select>
	
	<select id="selectOneProduct" resultType="hashmap">
		select p_id, p_name, image_route
		from product p join images i using(p_id)
		where image_rnk=1 and p_id=#{p_id}
	</select>
	<insert id="reviewInsert" parameterType="map">
		insert into REVIEW (REVIEW_ID, ORDER_ID, P_ID, USERID, REVIEW_TITLE, REVIEW_CONTENT,REVIEW_RATE, REVIEW_IMG, REVIEW_CREATED)
			values (REVIEW_REVIEW_ID_SEQ.nextval, #{ORDER_ID}, #{P_ID}, #{USERID}, #{REVIEW_TITLE}, #{REVIEW_CONTENT},
				#{REVIEW_RATE}, #{REVIEW_IMG}, sysdate)
	</insert> 
	<select id="orderIDreivewCheck" parameterType="int" resultType="int">
		select count(*) from review where order_ID = #{ORDER_ID}
	</select>
</mapper>