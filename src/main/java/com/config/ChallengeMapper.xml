<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ChallengeMapper">

<insert id="insertChallenge" parameterType="ChallengeDTO">
	insert into challenge (chall_id, userid, chall_title, chall_content, chall_category, chall_hits, chall_liked, chall_created, chall_img) 
	values (challenge_chall_id_seq.NEXTVAL, #{userid}, #{chall_title}, #{chall_content}, #{chall_category}, 0, 0, sysdate, #{chall_img})
</insert>

<select id="selectAllChallenge" parameterType="hashmap" resultType="ChallengeDTO">
	select * from challenge
	<where>
	  <!-- <if test='!"".equals(searchValue) and searchValue!=null'> -->
<!--  	  <if test='searchName!=null and searchValue!=null'>  -->
 	  <if test='searchName=="userid"'> 
 	  	userid like '%${searchValue}%'
		<!-- ${searchName} like '%${searchValue}%' -->
	  </if>
	  <if test='searchName=="chall_title"'> 
 	  	chall_title like '%${searchValue}%'
	  </if>
	  <if test='searchName=="chall_content"'> 
 	  	chall_content like '%${searchValue}%'
	  </if>
	</where> 
	order by chall_id desc
</select>

<select id="countTotal" parameterType="hashmap" resultType="int">
	select count(*) from challenge
 	<where>
 	 <!--  <if test='!"".equals(searchValue) and searchValue!=null'> -->
<!--  	  <if test='searchName!=null and searchValue!=null'> 
		${searchName} like '%${searchValue}%'
	  </if> -->
	  <if test='searchName=="userid"'> 
 	  	userid like '%${searchValue}%'
	  </if>
	  <if test='searchName=="chall_title"'> 
 	  	chall_title like '%${searchValue}%'
	  </if>
	  <if test='searchName=="chall_content"'> 
 	  	chall_content like '%${searchValue}%'
	  </if>
	</where> 
</select>

<select id="selectOneChallenge" resultType="ChallengeDTO">
	select * from challenge 
	where chall_id = #{chall_id}
</select>

<update id="updateChallenge" parameterType="hashmap">
	update challenge
	set chall_category=#{chall_category},
		chall_title=#{chall_title},
		chall_img=#{chall_img},
		chall_content=#{chall_content}
	where chall_id=#{chall_id}
</update>

<update id="updateChall_hits">
	update challenge
	set chall_hits=chall_hits+1
	where chall_id=#{chall_id}
</update>

<delete id="deleteChallenge">
	delete from challenge
	where chall_id=#{chall_id}
</delete>



<insert id="insertComment" parameterType="com.dto.CommentsDTO">
	insert into comments
	values (comments_comment_id_seq.NEXTVAL, #{chall_id}, #{comment_content}, sysdate, #{userid})
</insert>

<select id="selectAllComments" resultType="com.dto.CommentsDTO">
	select * from comments
	where chall_id=#{chall_id}
	order by comment_id
</select>

<delete id="deleteComment">
	delete from comments
	where comment_id=#{comment_id}
</delete>

<select id="countComments" resultType="int">
	select count(*) from comments
	where chall_id=#{chall_id}
</select>



<select id="selectProfile" resultType="hashmap">
	select * from profile
	where userid=#{userid}
</select>

</mapper>